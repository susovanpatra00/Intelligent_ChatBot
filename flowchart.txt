+-----------------------------+
|   User Sends POST /chat    |
+-----------------------------+
             |
             v
+-----------------------------+
|   Extract JSON Input        |
|   - query                   |
|   - use_reasoning           |
|   - use_web                 |
+-----------------------------+
             |
             v
+-----------------------------+
| Validate query (non-empty) |
+-----------------------------+
             |
             v
+------------------------------------+
| 1. search_similar_documents(query) |
|  -> Retrieve top 5 similar docs    |
+------------------------------------+
             |
             v
+------------------------------------+
| 2. generate_direct_answer(query,   |
|       top_docs)                   |
+------------------------------------+
             |
             v
+------------------------------------------------------------------------+
| 3. If reasoning enabled:                                               |
|    generate_reasoning_on_direct_answer_and_query(query, retrieval_ans) |
+------------------------------------------------------------------------+
             |
             v
+---------------------------------------------+
| 4. If web search enabled:                    |
|    perform_web_search(query) (async)         |
+---------------------------------------------+
             |
             v
+-------------------------------------------------------------+
| 5. generate_final_answer(query, retrieval_ans, reasoning,   |
|                         web_results)                        |
+-------------------------------------------------------------+
             |
             v
+---------------------------------------------------+
| 6. Build source file URLs                         |
|   - Check if PDF or Excel                         |
|   - Encode relative paths                         |
|   - Add row note for Excel if applicable          |
+---------------------------------------------------+
             |
             v
+-----------------------------------+
| 7. Return JSON response with:     |
|   - retrieval                     |
|   - reasoning                     |
|   - web                           |
|   - final                         |
|   - sources                       |
+-----------------------------------+



+------------------------------+
| POST /feedback Route         |
+------------------------------+
             |
             v
+------------------------------+
| Read 'liked' / 'disliked'    |
+------------------------------+
             |
             v
+------------------------------------+
| Initialize feedback CSV if needed |
+------------------------------------+
             |
             v
+------------------------------------+
| Update like/dislike counts         |
+------------------------------------+
             |
             v
+------------------------------+
| Return updated counts       |
+------------------------------+
